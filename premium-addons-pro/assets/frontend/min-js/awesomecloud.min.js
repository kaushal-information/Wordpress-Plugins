"use strict";window.setImmediate||(window.setImmediate=window.msSetImmediate||window.webkitSetImmediate||window.mozSetImmediate||window.oSetImmediate||function(){if(!window.postMessage||!window.addEventListener)return null;var r=[void 0],a="zero-timeout-message";return window.addEventListener("message",function(t){if("string"==typeof t.data&&t.data.substr(0,a.length)===a){t.stopImmediatePropagation();var e=parseInt(t.data.substr(a.length),36);r[e]&&(r[e](),r[e]=void 0)}},!0),window.clearImmediate=function(t){r[t]&&(r[t]=void 0)},function(t){var e=r.length;return r.push(t),window.postMessage(a+e.toString(36),"*"),e}}()||function(t){window.setTimeout(t,0)}),window.clearImmediate||(window.clearImmediate=window.msClearImmediate||window.webkitClearImmediate||window.mozClearImmediate||window.oClearImmediate||function(t){window.clearTimeout(t)}),function(t){function c(t){for(var e,r,a=t.length;a;)e=Math.floor(Math.random()*a),r=t[--a],t[a]=t[e],t[e]=r;return t}function e(y,t){if(u){var m=Math.floor(Math.random()*Date.now());Array.isArray(y)||(y=[y]),y.forEach(function(t,e){if("string"==typeof t){if(y[e]=document.getElementById(t),!y[e])throw new Error("The element id specified is not found.")}else if(!t.tagName&&!t.appendChild)throw new Error("You must pass valid HTML elements, or ID of the element.")});var E={list:[],fontFamily:'"Trebuchet MS", "Heiti TC", "微軟正黑體", "Arial Unicode MS", "Droid Fallback Sans", sans-serif',fontWeight:"normal",color:"random-dark",minSize:0,weightFactor:1,clearCanvas:!0,backgroundColor:"#fff",gridSize:8,drawOutOfBound:!1,shrinkToFit:!1,origin:null,wordsColors:[],drawMask:!1,maskColor:"rgba(255,0,0,0.3)",maskGapWidth:.3,wait:0,abortThreshold:0,abort:function(){},minRotation:-Math.PI/2,maxRotation:Math.PI/2,rotationSteps:0,shuffle:!0,rotateRatio:.1,shape:"circle",ellipticity:.65,classes:null,hover:null,click:null};if(t)for(var e in t)e in E&&(E[e]=t[e]);if("function"!=typeof E.weightFactor){var r=E.weightFactor;E.weightFactor=function(t){return t*r}}if("function"!=typeof E.shape)switch(E.shape){case"circle":default:E.shape="circle";break;case"cardioid":E.shape=function(t){return 1-Math.sin(t)};break;case"diamond":E.shape=function(t){var e=t%(2*Math.PI/4);return 1/(Math.cos(e)+Math.sin(e))};break;case"square":E.shape=function(t){return Math.min(1/Math.abs(Math.cos(t)),1/Math.abs(Math.sin(t)))};break;case"triangle-forward":E.shape=function(t){var e=t%(2*Math.PI/3);return 1/(Math.cos(e)+Math.sqrt(3)*Math.sin(e))};break;case"triangle":case"triangle-upright":E.shape=function(t){var e=(t+3*Math.PI/2)%(2*Math.PI/3);return 1/(Math.cos(e)+Math.sqrt(3)*Math.sin(e))};break;case"pentagon":E.shape=function(t){var e=(t+.955)%(2*Math.PI/5);return 1/(Math.cos(e)+.726543*Math.sin(e))};break;case"star":E.shape=function(t){var e=(t+.955)%(2*Math.PI/10);return 0<=(t+.955)%(2*Math.PI/5)-2*Math.PI/10?1/(Math.cos(2*Math.PI/10-e)+3.07768*Math.sin(2*Math.PI/10-e)):1/(Math.cos(e)+3.07768*Math.sin(e))}}E.gridSize=Math.max(Math.floor(E.gridSize),4);var I,S,F,w,P,g,R,O,A=E.gridSize,i=A-E.maskGapWidth,o=Math.abs(E.maxRotation-E.minRotation),n=Math.abs(Math.floor(E.rotationSteps)),l=Math.min(E.maxRotation,E.minRotation);switch(E.color){case"custom":R=function(){var t=Math.floor(Math.random()*E.wordsColors.length);return t=E.wordsColors[t]};break;case"random-dark":R=function(){return d(10,50)};break;case"random-light":R=function(){return d(50,90)};break;default:"function"==typeof E.color&&(R=E.color)}"function"==typeof E.fontWeight&&(O=E.fontWeight);var z=null;"function"==typeof E.classes&&(z=E.classes);var v,W=!1,M=[],a=function(t){var e,r,a=t.currentTarget,o=a.getBoundingClientRect();r=t.touches?(e=t.touches[0].clientX,t.touches[0].clientY):(e=t.clientX,t.clientY);var i=e-o.left,n=r-o.top,s=Math.floor(i*(a.width/o.width||1)/A),l=Math.floor(n*(a.height/o.height||1)/A);return M[s]?M[s][l]:null},p=function(t){var e=a(t);v!==e&&((v=e)?E.hover(e.item,e.dimension,t):E.hover(void 0,void 0,t))},x=function(t){var e=a(t);e&&(E.click(e.item,e.dimension,t),t.preventDefault())},s=[],f=function(t){if(s[t])return s[t];var e=8*t,r=e,a=[];for(0===t&&a.push([w[0],w[1],0]);r--;){var o=1;"circle"!==E.shape&&(o=E.shape(r/e*2*Math.PI)),a.push([w[0]+t*o*Math.cos(-r/e*2*Math.PI),w[1]+t*o*Math.sin(-r/e*2*Math.PI)*E.ellipticity,r/e*2*Math.PI])}return s[t]=a},L=function(){return 0<E.abortThreshold&&(new Date).getTime()-g>E.abortThreshold},D=function(t,e,r,a,o){if(!(S<=t||F<=e||t<0||e<0)){if(I[t][e]=!1,r)y[0].getContext("2d").fillRect(t*A,e*A,i,i);W&&(M[t][e]={item:o,dimension:a})}},b=function t(s){var M,p,x;Array.isArray(s)?(M=s[0],p=s[1]):(M=s.word,p=s.weight,x=s.attributes);var b=0===E.rotateRatio||Math.random()>E.rotateRatio?0:0===o?l:0<n?l+Math.floor(Math.random()*n)*o/(n-1):l+Math.random()*o,T=function(t){if(Array.isArray(t)){var e=t.slice();return e.splice(0,2),e}return[]}(s),C=function(t,e,r,a){var o=E.weightFactor(e);if(o<=E.minSize)return!1;var i,n=1;o<B&&(n=function(){for(var t=2;t*o<B;)t+=2;return t}()),i=O?O(t,e,o,a):E.fontWeight;var s=document.createElement("canvas"),l=s.getContext("2d",{willReadFrequently:!0});l.font=i+" "+(o*n).toString(10)+"px "+E.fontFamily;var f=l.measureText(t).width/n,d=Math.max(o*n,l.measureText("m").width,l.measureText("Ｗ").width)/n,c=f+2*d,u=3*d,h=Math.ceil(c/A),m=Math.ceil(u/A);c=h*A,u=m*A;var w=-f/2,g=.4*-d,v=Math.ceil((c*Math.abs(Math.sin(r))+u*Math.abs(Math.cos(r)))/A),M=Math.ceil((c*Math.abs(Math.cos(r))+u*Math.abs(Math.sin(r)))/A),p=M*A,x=v*A;s.setAttribute("width",p),s.setAttribute("height",x),l.scale(1/n,1/n),l.translate(p*n/2,x*n/2),l.rotate(-r),l.font=i+" "+(o*n).toString(10)+"px "+E.fontFamily,l.fillStyle="#000",l.textBaseline="middle",l.fillText(t,w*n,(g+.5*o)*n);var b=l.getImageData(0,0,p,x).data;if(L())return!1;for(var T,C,k,y=[],I=M,S=[v/2,M/2,v/2,M/2];I--;)for(T=v;T--;){k=A;t:for(;k--;)for(C=A;C--;)if(b[4*((T*A+k)*p+(I*A+C))+3]){y.push([I,T]),I<S[3]&&(S[3]=I),I>S[1]&&(S[1]=I),T<S[0]&&(S[0]=T),T>S[2]&&(S[2]=T);break t}0}return{mu:n,occupied:y,bounds:S,gw:M,gh:v,fillTextOffsetX:w,fillTextOffsetY:g,fillTextWidth:f,fillTextHeight:d,fontSize:o}}(M,p,b,T);if(!C)return!1;if(L())return!1;if(!E.drawOutOfBound&&!E.shrinkToFit){var e=C.bounds;if(e[1]-e[3]+1>S||e[2]-e[0]+1>F)return!1}for(var k=P+1,r=function(t){var l,f,d,c,e,r,a,u,h,o,m,w,g,v,i=Math.floor(t[0]-C.gw/2),n=Math.floor(t[1]-C.gh/2);C.gw,C.gh;return!!function(t,e,r){for(var a=r.length;a--;){var o=t+r[a][0],i=e+r[a][1];if(S<=o||F<=i||o<0||i<0){if(!E.drawOutOfBound)return!1}else if(!I[o][i])return!1}return!0}(i,n,C.occupied)&&(l=i,f=n,d=C,c=M,e=p,r=P-k,a=t[2],u=b,h=x,o=T,v=d.fontSize,m=R?R(c,e,v,r,a,o):E.color,w=O?O(c,e,v,o):E.fontWeight,g=z?z(c,e,v,o):E.classes,y.forEach(function(t){if(t.getContext){var e=t.getContext("2d"),r=d.mu;e.save(),e.scale(1/r,1/r),e.font=w+" "+(v*r).toString(10)+"px "+E.fontFamily,e.fillStyle=m,e.translate((l+d.gw/2)*A*r,(f+d.gh/2)*A*r),0!==u&&e.rotate(-u),e.textBaseline="middle",e.fillText(c,d.fillTextOffsetX*r,(d.fillTextOffsetY+.5*v)*r),e.restore()}else{var a=document.createElement("span"),o="";o="rotate("+-u/Math.PI*180+"deg) ",1!==d.mu&&(o+="translateX(-"+d.fillTextWidth/4+"px) scale("+1/d.mu+")");var i={position:"absolute",display:"block",font:w+" "+v*d.mu+"px "+E.fontFamily,left:(l+d.gw/2)*A+d.fillTextOffsetX+"px",top:(f+d.gh/2)*A+d.fillTextOffsetY+"px",width:d.fillTextWidth+"px",height:d.fillTextHeight+"px",lineHeight:v+"px",whiteSpace:"nowrap",transform:o,webkitTransform:o,msTransform:o,transformOrigin:"50% 40%",webkitTransformOrigin:"50% 40%",msTransformOrigin:"50% 40%"};for(var n in m&&(i.color=m),a.textContent=c,i)a.style[n]=i[n];if(h)for(var s in h)a.setAttribute(s,h[s]);g&&(a.className+=g),t.appendChild(a)}}),function(t,e,r,a){var o,i,n=r.occupied,s=E.drawMask;if(s&&((o=y[0].getContext("2d")).save(),o.fillStyle=E.maskColor),W){var l=r.bounds;i={x:(t+l[3])*A,y:(e+l[0])*A,w:(l[1]-l[3]+1)*A,h:(l[2]-l[0]+1)*A}}for(var f=n.length;f--;){var d=t+n[f][0],c=e+n[f][1];S<=d||F<=c||d<0||c<0||D(d,c,s,i,a)}s&&o.restore()}(i,n,C,s),!0)};k--;){var a=f(P-k);if(E.shuffle&&(a=[].concat(a),c(a)),a.some(r))return!0}return!!E.shrinkToFit&&(Array.isArray(s)?s[1]=3*s[1]/4:s.weight=3*s.weight/4,t(s))},T=function(r,t,a){if(t)return!y.some(function(t){var e=new CustomEvent(r,{detail:a||{}});return!t.dispatchEvent(e)},this);y.forEach(function(t){var e=new CustomEvent(r,{detail:a||{}});t.dispatchEvent(e)},this)};!function(){var e=y[0];if(e.getContext)S=Math.ceil(e.width/A),F=Math.ceil(e.height/A);else{var t=e.getBoundingClientRect();S=Math.ceil(t.width/A),F=Math.ceil(t.height/A)}if(T("wordcloudstart",!0)){var r,a,o,i,n;if(w=E.origin?[E.origin[0]/A,E.origin[1]/A]:[S/2,F/2],P=Math.floor(Math.sqrt(S*S+F*F)),I=[],!e.getContext||E.clearCanvas)for(y.forEach(function(t){if(t.getContext){var e=t.getContext("2d");e.fillStyle=E.backgroundColor,e.clearRect(0,0,S*(A+1),F*(A+1)),e.fillRect(0,0,S*(A+1),F*(A+1))}else t.textContent="",t.style.backgroundColor=E.backgroundColor,t.style.position="relative"}),r=S;r--;)for(I[r]=[],a=F;a--;)I[r][a]=!0;else{var s=document.createElement("canvas").getContext("2d");s.fillStyle=E.backgroundColor,s.fillRect(0,0,1,1);var l,f,d=s.getImageData(0,0,1,1).data,c=e.getContext("2d").getImageData(0,0,S*A,F*A).data;for(r=S;r--;)for(I[r]=[],a=F;a--;){f=A;t:for(;f--;)for(l=A;l--;)for(o=4;o--;)if(c[4*((a*A+f)*S*A+(r*A+l))+o]!==d[o]){I[r][a]=!1;break t}!1!==I[r][a]&&(I[r][a]=!0)}c=s=d=void 0}if(E.hover||E.click){for(W=!0,r=S+1;r--;)M[r]=[];E.hover&&e.addEventListener("mousemove",p),E.click&&(e.addEventListener("click",x),e.style.webkitTapHighlightColor="rgba(0, 0, 0, 0)"),e.addEventListener("wordcloudstart",function t(){e.removeEventListener("wordcloudstart",t),e.removeEventListener("mousemove",p),e.removeEventListener("click",x),v=void 0})}n=(o=0)!==E.wait?(i=window.setTimeout,window.clearTimeout):(i=window.setImmediate,window.clearImmediate);var u=function(e,r){y.forEach(function(t){t.removeEventListener(e,r)},this)},h=function t(){u("wordcloudstart",t),n(C[m])};!function(e,r){y.forEach(function(t){t.addEventListener(e,r)},this)}("wordcloudstart",h),b(["",1]),setTimeout(function(){C[m]=i(function t(){if(o>=E.list.length)return n(C[m]),T("wordcloudstop",!1),u("wordcloudstart",h),void delete C[m];g=(new Date).getTime();var e=b(E.list[o]),r=!T("wordclouddrawn",!0,{item:E.list[o],drawn:e});if(L()||r)return n(C[m]),E.abort(),T("wordcloudabort",!1),T("wordcloudstop",!1),u("wordcloudstart",h),void delete C[m];o++,C[m]=i(t,E.wait)},E.wait)},120)}}()}function d(t,e){return"hsl("+(360*Math.random()).toFixed()+","+(30*Math.random()+70).toFixed()+"%,"+(Math.random()*(e-t)+t).toFixed()+"%)"}}var u=function(){var t=document.createElement("canvas");if(!t||!t.getContext)return!1;var e=t.getContext("2d");return!!e&&(!!e.getImageData&&(!!e.fillText&&(!!Array.prototype.some&&!!Array.prototype.push)))}(),B=function(){if(u){for(var t,e,r=document.createElement("canvas").getContext("2d"),a=20;a;){if(r.font=a.toString(10)+"px sans-serif",r.measureText("Ｗ").width===t&&r.measureText("m").width===e)return a+1;t=r.measureText("Ｗ").width,e=r.measureText("m").width,a--}return 0}}(),C={};e.isSupported=u,e.minFontSize=B,e.stop=function(){if(C)for(var t in C)window.clearImmediate(C[t])},"function"==typeof define&&define.amd?(t.WordCloud=e,define("wordcloud",[],function(){return e})):"undefined"!=typeof module&&module.exports?module.exports=e:t.WordCloud=e}(this);