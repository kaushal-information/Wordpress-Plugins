"use strict";window.setImmediate||(window.setImmediate=window.msSetImmediate||window.webkitSetImmediate||window.mozSetImmediate||window.oSetImmediate||function(){if(!window.postMessage||!window.addEventListener)return null;var a=[void 0],i="zero-timeout-message";return window.addEventListener("message",function(t){"string"==typeof t.data&&t.data.substr(0,i.length)===i&&(t.stopImmediatePropagation(),t=parseInt(t.data.substr(i.length),36),a[t]&&(a[t](),a[t]=void 0))},!0),window.clearImmediate=function(t){a[t]&&(a[t]=void 0)},function(t){var e=a.length;return a.push(t),window.postMessage(i+e.toString(36),"*"),e}}()||function(t){window.setTimeout(t,0)}),window.clearImmediate||(window.clearImmediate=window.msClearImmediate||window.webkitClearImmediate||window.mozClearImmediate||window.oClearImmediate||function(t){window.clearTimeout(t)}),function(t){function e(I,t){if(n){var u=Math.floor(Math.random()*Date.now());(I=Array.isArray(I)?I:[I]).forEach(function(t,e){if("string"==typeof t){if(I[e]=document.getElementById(t),!I[e])throw new Error("The element id specified is not found.")}else if(!t.tagName&&!t.appendChild)throw new Error("You must pass valid HTML elements, or ID of the element.")});var e,k={list:[],fontFamily:'"Trebuchet MS", "Heiti TC", "微軟正黑體", "Arial Unicode MS", "Droid Fallback Sans", sans-serif',fontWeight:"normal",color:"random-dark",minSize:0,weightFactor:1,clearCanvas:!0,backgroundColor:"#fff",gridSize:8,drawOutOfBound:!1,shrinkToFit:!1,origin:null,drawMask:!1,maskColor:"rgba(255,0,0,0.3)",maskGapWidth:.3,wait:0,abortThreshold:0,abort:function(){},minRotation:-Math.PI/2,maxRotation:Math.PI/2,rotationSteps:0,shuffle:!0,rotateRatio:.1,shape:"circle",ellipticity:.65,classes:null,hover:null,click:null};if(t)for(var a in t)a in k&&(k[a]=t[a]);if("function"!=typeof k.weightFactor&&(e=k.weightFactor,k.weightFactor=function(t){return t*e}),"function"!=typeof k.shape)switch(k.shape){case"circle":default:k.shape="circle";break;case"cardioid":k.shape=function(t){return 1-Math.sin(t)};break;case"diamond":k.shape=function(t){return t%=2*Math.PI/4,1/(Math.cos(t)+Math.sin(t))};break;case"square":k.shape=function(t){return Math.min(1/Math.abs(Math.cos(t)),1/Math.abs(Math.sin(t)))};break;case"triangle-forward":k.shape=function(t){return t%=2*Math.PI/3,1/(Math.cos(t)+Math.sqrt(3)*Math.sin(t))};break;case"triangle":case"triangle-upright":k.shape=function(t){return t=(t+3*Math.PI/2)%(2*Math.PI/3),1/(Math.cos(t)+Math.sqrt(3)*Math.sin(t))};break;case"pentagon":k.shape=function(t){return t=(t+.955)%(2*Math.PI/5),1/(Math.cos(t)+.726543*Math.sin(t))};break;case"star":k.shape=function(t){var e=(t+.955)%(2*Math.PI/10);return 0<=(t+.955)%(2*Math.PI/5)-2*Math.PI/10?1/(Math.cos(2*Math.PI/10-e)+3.07768*Math.sin(2*Math.PI/10-e)):1/(Math.cos(e)+3.07768*Math.sin(e))}}k.gridSize=Math.max(Math.floor(k.gridSize),4);var C,S,E,m,F,w,P,R,O=k.gridSize,A=O-k.maskGapWidth,r=Math.abs(k.maxRotation-k.minRotation),s=Math.abs(Math.floor(k.rotationSteps)),l=Math.min(k.maxRotation,k.minRotation);switch(k.color){case"random-dark":P=function(){return o(10,50)};break;case"random-light":P=function(){return o(50,90)};break;default:"function"==typeof k.color&&(P=k.color)}"function"==typeof k.fontWeight&&(R=k.fontWeight);var z=null;"function"==typeof k.classes&&(z=k.classes);var g,W=!1,L=[],i=function(t){var e=t.currentTarget,a=e.getBoundingClientRect(),i=(t=t.touches?(i=t.touches[0].clientX,t.touches[0].clientY):(i=t.clientX,t.clientY),i-a.left);t-=a.top,i=Math.floor(i*(e.width/a.width||1)/O),a=Math.floor(t*(e.height/a.height||1)/O);return L[i][a]},v=function(t){var e=i(t);g!==e&&((g=e)?k.hover(e.item,e.dimension,t):k.hover(void 0,void 0,t))},M=function(t){var e=i(t);e&&(k.click(e.item,e.dimension,t),t.preventDefault())},d=[],D=function(){return 0<k.abortThreshold&&(new Date).getTime()-w>k.abortThreshold},p=function t(n){var v,M,p;Array.isArray(n)?(v=n[0],M=n[1]):(v=n.word,M=n.weight,p=n.attributes);var e,x=0===k.rotateRatio||Math.random()>k.rotateRatio?0:0===r?l:0<s?l+Math.floor(Math.random()*s)*r/(s-1):l+Math.random()*r,b=(e=n,Array.isArray(e)?((e=e.slice()).splice(0,2),e):[]),T=function(t,e,a,i){var o=k.weightFactor(e);if(o<=k.minSize)return!1;var r=1;o<B&&(r=function(){for(var t=2;t*o<B;)t+=2;return t}());var n=R?R(t,e,o,i):k.fontWeight,s=document.createElement("canvas"),l=s.getContext("2d",{willReadFrequently:!0});l.font=n+" "+(o*r).toString(10)+"px "+k.fontFamily;var d=l.measureText(t).width/r,f=Math.max(o*r,l.measureText("m").width,l.measureText("Ｗ").width)/r,c=d+2*f,h=3*f,u=(e=Math.ceil(c/O),i=Math.ceil(h/O),c=e*O,h=i*O,e=-d/2,i=.4*-f,Math.ceil((c*Math.abs(Math.sin(a))+h*Math.abs(Math.cos(a)))/O)),m=(c=Math.ceil((c*Math.abs(Math.cos(a))+h*Math.abs(Math.sin(a)))/O))*O;h=u*O;s.setAttribute("width",m),s.setAttribute("height",h),l.scale(1/r,1/r),l.translate(m*r/2,h*r/2),l.rotate(-a),l.font=n+" "+(o*r).toString(10)+"px "+k.fontFamily,l.fillStyle="#000",l.textBaseline="middle",l.fillText(t,e*r,(i+.5*o)*r);var w=l.getImageData(0,0,m,h).data;if(D())return!1;for(var g,v,M,p=[],x=c,b=[u/2,c/2,u/2,c/2];x--;)for(g=u;g--;){M=O;t:for(;M--;)for(v=O;v--;)if(w[4*((g*O+M)*m+(x*O+v))+3]){p.push([x,g]),x<b[3]&&(b[3]=x),x>b[1]&&(b[1]=x),g<b[0]&&(b[0]=g),g>b[2]&&(b[2]=g);break t}}return{mu:r,occupied:p,bounds:b,gw:c,gh:u,fillTextOffsetX:e,fillTextOffsetY:i,fillTextWidth:d,fillTextHeight:f,fontSize:o}}(v,M,x,b);if(!T)return!1;if(D())return!1;if(!k.drawOutOfBound&&!k.shrinkToFit){var a=T.bounds;if(a[1]-a[3]+1>S||a[2]-a[0]+1>E)return!1}for(var y=F+1,i=function(t){var s,l,d,f,e,a,i,c,h,u,m,w,g,o=Math.floor(t[0]-T.gw/2),r=Math.floor(t[1]-T.gh/2);return T.gw,T.gh,!!function(t,e,a){for(var i=a.length;i--;){var o=t+a[i][0],r=e+a[i][1];if(S<=o||E<=r||o<0||r<0){if(!k.drawOutOfBound)return}else if(!C[o][r])return}return 1}(o,r,T.occupied)&&(s=o,l=r,d=T,f=v,e=M,a=F-y,i=t[2],c=x,h=p,t=b,u=d.fontSize,m=P?P(f,e,u,a,i,t):k.color,w=R?R(f,e,u,t):k.fontWeight,g=z?z(f,e,u,t):k.classes,I.forEach(function(t){if(t.getContext){var e=t.getContext("2d"),a=d.mu;e.save(),e.scale(1/a,1/a),e.font=w+" "+(u*a).toString(10)+"px "+k.fontFamily,e.fillStyle=m,e.translate((s+d.gw/2)*O*a,(l+d.gh/2)*O*a),0!==c&&e.rotate(-c),e.textBaseline="middle",e.fillText(f,d.fillTextOffsetX*a,(d.fillTextOffsetY+.5*u)*a),e.restore()}else{var i=document.createElement("span");e="",e="rotate("+-c/Math.PI*180+"deg) ";1!==d.mu&&(e+="translateX(-"+d.fillTextWidth/4+"px) scale("+1/d.mu+")");var o,r={position:"absolute",display:"block",font:w+" "+u*d.mu+"px "+k.fontFamily,left:(s+d.gw/2)*O+d.fillTextOffsetX+"px",top:(l+d.gh/2)*O+d.fillTextOffsetY+"px",width:d.fillTextWidth+"px",height:d.fillTextHeight+"px",lineHeight:u+"px",whiteSpace:"nowrap",transform:e,webkitTransform:e,msTransform:e,transformOrigin:"50% 40%",webkitTransformOrigin:"50% 40%",msTransformOrigin:"50% 40%"};for(o in m&&(r.color=m),i.textContent=f,r)i.style[o]=r[o];if(h)for(var n in h)i.setAttribute(n,h[n]);g&&(i.className+=g),t.appendChild(i)}}),function(t,e,a,i){var o,r,n=a.occupied,s=k.drawMask;s&&((o=I[0].getContext("2d")).save(),o.fillStyle=k.maskColor),W&&(r={x:(t+(a=a.bounds)[3])*O,y:(e+a[0])*O,w:(a[1]-a[3]+1)*O,h:(a[2]-a[0]+1)*O});for(var l,d,f,c=n.length;c--;){var h=t+n[c][0],u=e+n[c][1];S<=h||E<=u||h<0||u<0||(l=u,d=s,f=r,u=i,S<=(h=h)||E<=l||h<0||l<0||(C[h][l]=!1,d&&I[0].getContext("2d").fillRect(h*O,l*O,A,A),W&&(L[h][l]={item:u,dimension:f})))}s&&o.restore()}(o,r,T,n),!0)};y--;){var o=function(t){if(d[t])return d[t];var e=8*t,a=e,i=[];for(0==t&&i.push([m[0],m[1],0]);a--;){var o=1;"circle"!==k.shape&&(o=k.shape(a/e*2*Math.PI)),i.push([m[0]+t*o*Math.cos(-a/e*2*Math.PI),m[1]+t*o*Math.sin(-a/e*2*Math.PI)*k.ellipticity,a/e*2*Math.PI])}return d[t]=i}(F-y);if(k.shuffle&&function(t){for(var e,a,i=t.length;i;)e=Math.floor(Math.random()*i),a=t[--i],t[i]=t[e],t[e]=a}(o=[].concat(o)),o.some(i))return!0}return!!k.shrinkToFit&&(Array.isArray(n)?n[1]=3*n[1]/4:n.weight=3*n.weight/4,t(n))},x=function(a,t,i){if(t)return!I.some(function(t){var e=new CustomEvent(a,{detail:i||{}});return!t.dispatchEvent(e)},this);I.forEach(function(t){var e=new CustomEvent(a,{detail:i||{}});t.dispatchEvent(e)},this)};!function(){var t,a,e=I[0];if(E=e.getContext?(S=Math.ceil(e.width/O),Math.ceil(e.height/O)):(i=e.getBoundingClientRect(),S=Math.ceil(i.width/O),Math.ceil(i.height/O)),x("wordcloudstart",!0)){if(m=k.origin?[k.origin[0]/O,k.origin[1]/O]:[S/2,E/2],F=Math.floor(Math.sqrt(S*S+E*E)),C=[],!e.getContext||k.clearCanvas)for(I.forEach(function(t){var e;t.getContext?((e=t.getContext("2d")).fillStyle=k.backgroundColor,e.clearRect(0,0,S*(O+1),E*(O+1)),e.fillRect(0,0,S*(O+1),E*(O+1))):(t.textContent="",t.style.backgroundColor=k.backgroundColor,t.style.position="relative")}),l=S;l--;)for(C[l]=[],t=E;t--;)C[l][t]=!0;else{var i=document.createElement("canvas").getContext("2d");i.fillStyle=k.backgroundColor,i.fillRect(0,0,1,1);for(var o,r,n=i.getImageData(0,0,1,1).data,s=e.getContext("2d").getImageData(0,0,S*O,E*O).data,l=S;l--;)for(C[l]=[],t=E;t--;){r=O;t:for(;r--;)for(o=O;o--;)for(d=4;d--;)if(s[4*((t*O+r)*S*O+(l*O+o))+d]!==n[d]){C[l][t]=!1;break t}!1!==C[l][t]&&(C[l][t]=!0)}s=i=n=void 0}if(k.hover||k.click){for(W=!0,l=S+1;l--;)L[l]=[];k.hover&&e.addEventListener("mousemove",v),k.click&&(e.addEventListener("click",M),e.style.webkitTapHighlightColor="rgba(0, 0, 0, 0)"),e.addEventListener("wordcloudstart",function t(){e.removeEventListener("wordcloudstart",t),e.removeEventListener("mousemove",v),e.removeEventListener("click",M),g=void 0})}var d=0,f=0!==k.wait?(a=window.setTimeout,window.clearTimeout):(a=window.setImmediate,window.clearImmediate),c=function(e,a){I.forEach(function(t){t.removeEventListener(e,a)},this)},h=function t(){c("wordcloudstart",t),f(b[u])};!function(e){I.forEach(function(t){t.addEventListener("wordcloudstart",e)},this)}(h),b[u]=a(function t(){if(d>=k.list.length)return f(b[u]),x("wordcloudstop",!1),c("wordcloudstart",h),void delete b[u];w=(new Date).getTime();var e=p(k.list[d]);e=!x("wordclouddrawn",!0,{item:k.list[d],drawn:e});if(D()||e)return f(b[u]),k.abort(),x("wordcloudabort",!1),x("wordcloudstop",!1),c("wordcloudstart",h),void delete b[u];d++,b[u]=a(t,k.wait)},k.wait)}}()}function o(t,e){return"hsl("+(360*Math.random()).toFixed()+","+(30*Math.random()+70).toFixed()+"%,"+(Math.random()*(e-t)+t).toFixed()+"%)"}}var a,n=!(!(a=document.createElement("canvas"))||!a.getContext||!((a=a.getContext("2d"))&&a.getImageData&&a.fillText&&Array.prototype.some&&Array.prototype.push)),B=function(){if(n){for(var t,e,a=document.createElement("canvas").getContext("2d"),i=20;i;){if(a.font=i.toString(10)+"px sans-serif",a.measureText("Ｗ").width===t&&a.measureText("m").width===e)return i+1;t=a.measureText("Ｗ").width,e=a.measureText("m").width,i--}return 0}}(),b={};e.isSupported=n,e.minFontSize=B,e.stop=function(){if(b)for(var t in b)window.clearImmediate(b[t])},"function"==typeof define&&define.amd?(t.WordCloud=e,define("wordcloud",[],function(){return e})):"undefined"!=typeof module&&module.exports?module.exports=e:t.WordCloud=e}(this);